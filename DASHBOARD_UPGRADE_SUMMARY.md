# Dashboard ä¸“ä¸šä»ªè¡¨ç›˜å¸ƒå±€å‡çº§æ€»ç»“

## æ¦‚è¿°
æœ¬æ¬¡å‡çº§å®ç°äº†ä¸“ä¸šä»ªè¡¨ç›˜å¸ƒå±€ï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼ŒåŒ…å«ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **70-30 æ …æ ¼å¸ƒå±€** - åˆ›å»ºè§†è§‰ç„¦ç‚¹çš„ä¸“ä¸šå¸ƒå±€
2. **SLA å¯¹æ¯”å›¾** - æ›¿æ¢çŠ¶æ€æ—¶é•¿åˆ†å¸ƒï¼Œæ˜¾ç¤ºå¤šæ—¶é—´çª—å£å¯ç”¨ç‡
3. **P95/P99 å¢å¼º** - å“åº”æ—¶é—´å›¾æ·»åŠ æ€§èƒ½ç™¾åˆ†ä½çº¿
4. **è”åŠ¨äº¤äº’** - Uptime å†å²å›¾ä¸å‘Šè­¦å†å²çš„æ™ºèƒ½è”åŠ¨

## è¯¦ç»†æ”¹åŠ¨

### 1. å¸ƒå±€é‡æ„ (70-30 æ …æ ¼)

#### HTML ç»“æ„ (`app/templates/dashboard.html`)
- å¼•å…¥ `dashboard-grid` å®¹å™¨ï¼Œå®ç°å“åº”å¼æ …æ ¼å¸ƒå±€
- å·¦ä¾§ä¸»åŒºåŸŸ (`dashboard-main`ï¼Œ70% å®½åº¦)ï¼š
  - å®æ—¶çŠ¶æ€å¢™
  - ç«™ç‚¹é€‰æ‹©å™¨
  - Uptime å†å²çŠ¶æ€å›¾
  - å“åº”æ—¶é—´å¯¹æ¯”å›¾
  - æ—¥å¿—å‘Šè­¦å†å²è¡¨æ ¼
- å³ä¾§æ¬¡çº§ä¿¡æ¯æ  (`dashboard-sidebar`ï¼Œ30% å®½åº¦)ï¼š
  - 4 ä¸ªæ‘˜è¦å¡ç‰‡ï¼ˆå·²é€‰ç«™ç‚¹ã€å¹³å‡å¯ç”¨ç‡ã€å¹³å‡å“åº”æ—¶é—´ã€å¼‚å¸¸äº‹ä»¶ï¼‰
  - SLA å¯¹æ¯”å›¾ï¼ˆæ–°å¢ï¼‰

#### CSS æ ·å¼ (`app/static/css/dashboard.css`)
```css
.dashboard-grid {
    display: grid;
    grid-template-columns: 1fr;  /* ç§»åŠ¨ç«¯å•åˆ— */
}

@media (min-width: 1200px) {
    .dashboard-grid {
        grid-template-columns: 70fr 30fr;  /* æ¡Œé¢ç«¯ 70-30 å¸ƒå±€ */
    }
    .dashboard-sidebar {
        position: sticky;
        top: 80px;  /* ç²˜æ€§å®šä½ï¼Œä¿æŒå¯è§ */
    }
}
```

### 2. SLA å¯¹æ¯”å›¾

#### åç«¯ API å¢å¼º (`app/routes.py`)
åœ¨ `/api/history` ç«¯ç‚¹ä¸­æ·»åŠ  SLA ç»Ÿè®¡è®¡ç®—ï¼š

```python
# è®¡ç®—ä¸åŒæ—¶é—´çª—å£çš„å¯ç”¨ç‡
now_utc = datetime.datetime.now(timezone.utc)
today_start = datetime.datetime.combine(now_utc.date(), datetime.time.min, tzinfo=timezone.utc)
week_start = now_utc - datetime.timedelta(days=7)
month_start = now_utc - datetime.timedelta(days=30)

sla_today = calc_availability_for_period(today_start, now_utc)
sla_week = calc_availability_for_period(week_start, now_utc)
sla_month = calc_availability_for_period(month_start, now_utc)

results[site]["sla_stats"] = {
    "today": sla_today,
    "week": sla_week,
    "month": sla_month
}
```

#### å‰ç«¯æ¸²æŸ“ (`app/static/js/dashboard.js`)
- åˆ›å»º `renderSLAComparison()` å‡½æ•°
- ä½¿ç”¨ ECharts æ¨ªå‘æ¡å½¢å›¾ï¼ˆbar chartï¼‰
- æ¯ä¸ªç«™ç‚¹æ˜¾ç¤º 3 ä¸ªæ¡å½¢ï¼ˆä»Šæ—¥ã€è¿‘7å¤©ã€è¿‘30å¤©ï¼‰
- æ ¹æ®å¯ç”¨ç‡è‡ªåŠ¨ç€è‰²ï¼š
  - â‰¥ 99.99% â†’ ç»¿è‰²ç³»
  - â‰¥ 99.9% â†’ æµ…ç»¿è‰²
  - â‰¥ 99% â†’ é»„ç»¿è‰²
  - â‰¥ 95% â†’ æ©™è‰²
  - < 95% â†’ çº¢è‰²
- Tooltip æ˜¾ç¤ºå¯ç”¨ç‡å’Œ"å‡ ä¸ª9"æ ‡ç­¾

### 3. P95/P99 å¢å¼º

#### åç«¯è®¡ç®— (`app/routes.py`)
```python
# è®¡ç®— P95 å’Œ P99
p95_response_time = 0
p99_response_time = 0
if valid_times:
    sorted_times = sorted(valid_times)
    p95_index = int(len(sorted_times) * 0.95)
    p99_index = int(len(sorted_times) * 0.99)
    p95_response_time = sorted_times[min(p95_index, len(sorted_times) - 1)]
    p99_response_time = sorted_times[min(p99_index, len(sorted_times) - 1)]

results[site]["overall_stats"]["p95_response_time"] = p95_response_time
results[site]["overall_stats"]["p99_response_time"] = p99_response_time
```

#### å‰ç«¯æ¸²æŸ“ (`app/static/js/dashboard.js`)
- åœ¨ `renderComparisonCharts()` ä¸­å¢å¼ºå“åº”æ—¶é—´å›¾
- ä¸ºæ¯ä¸ªç«™ç‚¹æ·»åŠ  P95 å’Œ P99 å‚è€ƒçº¿ï¼š
  - P95 ä½¿ç”¨è™šçº¿ï¼ˆdashedï¼‰
  - P99 ä½¿ç”¨ç‚¹çº¿ï¼ˆdottedï¼‰
  - é€æ˜åº¦ 0.7ï¼Œä¸å“åº”é¼ æ ‡äº‹ä»¶ï¼ˆsilent: trueï¼‰
- åœ¨å›¾ä¾‹ä¸­æ˜¾ç¤º P95/P99 çº¿

### 4. Uptime å†å²å›¾ä¸å‘Šè­¦å†å²è”åŠ¨

#### ç‚¹å‡»äº‹ä»¶å¤„ç† (`app/static/js/dashboard.js`)
```javascript
timelineChart.on('click', function (params) {
    if (params.seriesType === 'custom' && params.value) {
        const status = params.value[3];
        const startTime = params.value[1];
        const endTime = params.value[2];
        const siteName = params.seriesName;
        
        // åªæœ‰å®•æœºæˆ–æ…¢å“åº”æ‰è”åŠ¨
        if (status === 3 || status === 2) {
            filterAndScrollToAlerts(siteName, startTime, endTime, status);
        }
    }
});
```

#### è”åŠ¨åŠŸèƒ½ (`filterAndScrollToAlerts()`)
1. **æ»šåŠ¨åˆ°å‘Šè­¦å†å²åŒºåŸŸ** - ä½¿ç”¨ `scrollIntoView()`
2. **è‡ªåŠ¨ç­›é€‰å‘Šè­¦ç±»å‹**ï¼š
   - å®•æœºï¼ˆstatus === 3ï¼‰â†’ ç­›é€‰ "å®•æœº"
   - æ…¢å“åº”ï¼ˆstatus === 2ï¼‰â†’ ç­›é€‰ "è®¿é—®è¿‡æ…¢"
3. **é«˜äº®åŒ¹é…çš„å‘Šè­¦è®°å½•**ï¼š
   - æ ¹æ®ç«™ç‚¹åç§°å’Œæ—¶é—´èŒƒå›´åŒ¹é…
   - èƒŒæ™¯è‰²å˜ä¸ºæ·¡é»„è‰² (#fffacd)
   - 3ç§’åè‡ªåŠ¨æ¢å¤
4. **Tooltip æç¤º** - åœ¨å®•æœº/æ…¢å“åº”åˆ†æ®µçš„ tooltip ä¸­æ˜¾ç¤º "ğŸ’¡ ç‚¹å‡»æŸ¥çœ‹ç›¸å…³å‘Šè­¦"

## ç”¨æˆ·ä½“éªŒæå‡

### å¸ƒå±€ä¼˜åŒ–
- **è§†è§‰ç„¦ç‚¹æ˜ç¡®**ï¼šä¸»å›¾è¡¨å æ® 70% å®½åº¦ï¼Œä¸€ç›®äº†ç„¶
- **ä¿¡æ¯åˆ†å±‚**ï¼šæ ¸å¿ƒæ•°æ®åœ¨ä¸»åŒºåŸŸï¼Œæ¦‚è§ˆæ•°æ®åœ¨ä¾§è¾¹æ 
- **å‡å°‘æ»šåŠ¨**ï¼šå…³é”®ä¿¡æ¯åœ¨ä¸€å±å†…å¯è§
- **å“åº”å¼è®¾è®¡**ï¼šç§»åŠ¨ç«¯è‡ªåŠ¨åˆ‡æ¢ä¸ºå•åˆ—å¸ƒå±€

### æ•°æ®æ´å¯Ÿ
- **SLA å¯¹æ¯”**ï¼šå¿«é€Ÿå¯¹æ¯”ä¸åŒæ—¶é—´çª—å£çš„ç¨³å®šæ€§
- **æ€§èƒ½ç™¾åˆ†ä½**ï¼šP95/P99 çº¿æ›´èƒ½åæ˜ ç”¨æˆ·ä½“éªŒçš„"å¤©èŠ±æ¿"
- **è”åŠ¨åˆ†æ**ï¼šä»å®è§‚ï¼ˆUptime å›¾ï¼‰åˆ°å¾®è§‚ï¼ˆå‘Šè­¦è¯¦æƒ…ï¼‰çš„æµç•…åˆ†æè·¯å¾„

### äº¤äº’åé¦ˆ
- **å¯ç‚¹å‡»æç¤º**ï¼šTooltip ä¸­æ˜ç¡®æç¤ºå¯ç‚¹å‡»
- **è§†è§‰é«˜äº®**ï¼šé«˜äº®æ˜¾ç¤ºåŒ¹é…çš„å‘Šè­¦è®°å½•
- **å¹³æ»‘æ»šåŠ¨**ï¼šä½¿ç”¨ smooth scrolling æå‡ä½“éªŒ

## æŠ€æœ¯äº®ç‚¹

1. **å“åº”å¼æ …æ ¼å¸ƒå±€** - ä½¿ç”¨ CSS Gridï¼Œæ”¯æŒå¤šç§å±å¹•å°ºå¯¸
2. **ç²˜æ€§å®šä½** - ä¾§è¾¹æ ä½¿ç”¨ sticky positioningï¼Œä¿æŒå¯è§
3. **æ•°æ®èšåˆè®¡ç®—** - åç«¯é«˜æ•ˆè®¡ç®— P95/P99 å’Œå¤šæ—¶é—´çª—å£ SLA
4. **ECharts é«˜çº§ç‰¹æ€§** - ä½¿ç”¨è‡ªå®šä¹‰æ¸²æŸ“ã€äº‹ä»¶ç›‘å¬ã€åŠ¨æ€ç€è‰²
5. **æ—¶é—´èŒƒå›´åŒ¹é…** - ç²¾å‡†åŒ¹é…å‘Šè­¦è®°å½•çš„æ—¶é—´èŒƒå›´

## æµ‹è¯•éªŒè¯

æ‰€æœ‰åŠŸèƒ½å·²é€šè¿‡æµ‹è¯•ï¼š
- âœ… å¸ƒå±€åœ¨æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯æ­£å¸¸æ˜¾ç¤º
- âœ… SLA å¯¹æ¯”å›¾æ­£ç¡®æ˜¾ç¤ºä¸åŒæ—¶é—´çª—å£æ•°æ®
- âœ… P95/P99 çº¿æ­£ç¡®æ¸²æŸ“åœ¨å“åº”æ—¶é—´å›¾ä¸­
- âœ… ç‚¹å‡» Uptime å›¾çš„å®•æœº/æ…¢å“åº”åˆ†æ®µèƒ½æ­£ç¡®è”åŠ¨
- âœ… API è¿”å›å®Œæ•´çš„ sla_stats å’Œ p95/p99 æ•°æ®

## æ–‡ä»¶æ¸…å•

ä¿®æ”¹çš„æ–‡ä»¶ï¼š
1. `app/templates/dashboard.html` - HTML ç»“æ„é‡æ„
2. `app/static/css/dashboard.css` - æ …æ ¼å¸ƒå±€æ ·å¼
3. `app/static/js/dashboard.js` - å‰ç«¯é€»è¾‘å¢å¼º
4. `app/routes.py` - åç«¯ API æ•°æ®å¢å¼º

æ–°å¢çš„æ–‡ä»¶ï¼š
1. `test_dashboard.html` - åŠŸèƒ½æµ‹è¯•é¡µé¢
2. `DASHBOARD_UPGRADE_SUMMARY.md` - æœ¬æ–‡æ¡£

## éƒ¨ç½²è¯´æ˜

æ— éœ€ç‰¹æ®Šéƒ¨ç½²æ­¥éª¤ï¼Œæ›´æ”¹å³ç”Ÿæ•ˆã€‚å»ºè®®ï¼š
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ä»¥åŠ è½½æ–°çš„ CSS/JS
2. ç¡®ä¿æœ‰è¶³å¤Ÿçš„å†å²æ•°æ®ä»¥æ˜¾ç¤ºå®Œæ•´çš„ SLA å¯¹æ¯”
3. åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹æµ‹è¯•å“åº”å¼å¸ƒå±€

## æœªæ¥ä¼˜åŒ–å»ºè®®

1. **å¼‚å¸¸ç‚¹æ ‡è®°** - åœ¨å“åº”æ—¶é—´å›¾ä¸Šé«˜äº®æ˜¾ç¤ºè¶…è¿‡é˜ˆå€¼çš„ç‚¹
2. **å¹³å‡çº¿** - ä¸ºæ¯ä¸ªç«™ç‚¹æ·»åŠ è´¯ç©¿å§‹ç»ˆçš„å¹³å‡å“åº”æ—¶é—´è™šçº¿
3. **å‘Šè­¦æ—¶é—´è½´** - åœ¨ Uptime å›¾ä¸‹æ–¹æ·»åŠ å‘Šè­¦äº‹ä»¶æ ‡è®°
4. **å¯¼å‡ºåŠŸèƒ½** - æ”¯æŒå¯¼å‡º SLA æŠ¥å‘Šå’Œå›¾è¡¨
5. **å¯¹æ¯”æ¨¡å¼** - æ”¯æŒé€‰æ‹©ä¸åŒæ—¶é—´æ®µè¿›è¡Œ SLA å¯¹æ¯”

---

**å‡çº§å®Œæˆæ—¶é—´**: 2025-01-23  
**ç‰ˆæœ¬**: v2.0 - ä¸“ä¸šä»ªè¡¨ç›˜å¸ƒå±€
